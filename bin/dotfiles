#!/usr/bin/env python

import os
import imp
import glob

home = os.environ['HOME']
lib = imp.load_source('lib', os.path.join(home, 'config', 'bin', 'common.py'))

dotfiles = os.path.abspath(os.path.join(home, 'config', 'dotfiles'))
for root, _, filenames in os.walk(dotfiles):
    for filename in filenames:
        filename = os.path.join(root, filename)
        src = os.path.abspath(filename)
        dst = os.path.join(home, src.replace(dotfiles + '/', '.'))
        lib.ensure_link(src, dst)

perms = [('ssh/config', 0664)]
for filename, mode in perms:
    os.chmod(os.path.join(dotfiles, filename), mode)

tools = ['tools/goplay',
         'tools/git-horror']
for tool in tools:
    for src in glob.glob(os.path.join(home, tool, '*')):
        dst = os.path.join(home, '.local', 'bin', os.path.basename(src))
        if os.access(src, os.X_OK):
            lib.ensure_link(src, dst)
